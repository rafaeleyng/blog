<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="preload" href="https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&amp;display=optional" as="style"/><title>JavaScript Code Coverage With Instanbul and Coveralls</title><meta name="description" content="Rafael Eyng&#x27;s tech blog"/><meta name="language" content="en"/><meta name="content-language" content="en"/><meta name="author" content="Rafael Eyng"/><meta name="keywords" content="software, development, javascript, github, node, docker, blog"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="canonical" href="https://rafaeleyng.github.io/javascript-code-coverage-with-instanbul-and-coveralls"/><link rel="shortcut icon" href="/favicon.png" type="image/x-icon"/><link href="https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&amp;display=optional" rel="stylesheet" type="text/css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-154633858-1"></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-154633858-1');
</script><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/60cb64cc4f732b57203c53cc08057239476ea6be_CSS.7b3f6175.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/60cb64cc4f732b57203c53cc08057239476ea6be_CSS.7b3f6175.chunk.css"/><link rel="preload" href="/_next/static/AhDaCruZbHr7pP-l8v6XC/pages/post.js" as="script"/><link rel="preload" href="/_next/static/AhDaCruZbHr7pP-l8v6XC/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.03885e3762b811c06d48.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.2d46a4062a63030a7155.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-fd16d9fd7045bb52879a.js" as="script"/><link rel="preload" href="/_next/static/chunks/a1bc03cf.0a53ccc93557b67d94bb.js" as="script"/><link rel="preload" href="/_next/static/chunks/60cb64cc4f732b57203c53cc08057239476ea6be.b5baf6500ce0ba950094.js" as="script"/><link rel="preload" href="/_next/static/chunks/60cb64cc4f732b57203c53cc08057239476ea6be_CSS.37da1e6c94fa5227f4d3.js" as="script"/></head><body><div id="__next"><div class="container"><header class="site-header single-column"><a class="blog-title" href="/">Rafael Eyng&#x27;s Blog</a><nav class="blog-menu"><a target="_blank" rel="noopener" href="https://rafaeleyng.github.io/me">About</a><a target="_blank" rel="noopener" href="https://github.com/rafaeleyng/rafaeleyng.github.io">Github</a></nav></header></div><header class="page-header"><div class="container single-column"><h1>JavaScript Code Coverage With Instanbul and Coveralls</h1><p class="post-meta"><time itemProp="datePublished" dateTime="2016-01-14">Jan 14, 2016</time></p></div></header><main class="container single-column"><section class="post"><span class="hidden" itemProp="publisher">Rafael Eyng</span><span class="hidden" itemProp="keywords">test, coverage, javascript, npm</span><article class="post-content" itemProp="articleBody"><h2>Code coverage</h2><p>If you want to set up code coverage measurements in a project, there are usually 4 things that you&#x27;ll need:</p><ul><li>a <strong>test runner</strong> (like <a href="https://github.com/mochajs/mocha">Mocha</a>, <a href="https://github.com/sindresorhus/ava">AVA</a>), to run your tests</li><li>a <strong>code coverage</strong> tool (like <a href="https://github.com/gotwarlost/istanbul">Istanbul</a>, <a href="https://github.com/bcoe/nyc">nyc</a>), to generate code coverage reports</li><li>a <strong>code coverage insight</strong> service (like <a href="https://coveralls.io/">Coveralls</a>, <a href="https://codecov.io/">Codecov</a>), to provide you a nice visualization of your code coverage data</li><li>a <strong>reporting</strong> tool (like <a href="https://github.com/nickmerwin/node-coveralls">node-coveralls</a>, <a href="https://github.com/cainus/codecov.io/">codecov.io</a>), to send your reports to some service</li></ul><h2>Assumptions</h2><p>I&#x27;ll assume you already have Mocha locally installed (<code>npm i -D mocha</code>) as your test runner, and show you how to do the rest.</p><p>I&#x27;ll also assume that you have TravisCI server configured for your project.</p><h3>npm scripts</h3><p>npm scripts are scripts you add inside package.json. You can add arbitrary shell script commands there, like: <code>&quot;scripts&quot;: { &quot;print-something&quot;: &quot;echo &#x27;something&#x27;&quot; }</code>. You can run this script by invoking it by its name: <code>npm run print-something</code>.</p><p>I try to use npm scripts as much as possible, to avoid global dependencies and to avoid the clutter to manually invoke local dependencies. So all examples here will use this approach.</p><h2>Code coverage tool</h2><p>The principle is: instead of directly running your tests, you set up a middle man to do this and generate the coverage reports. Enter Istanbul.</p><pre><code class="language-sh">npm i -D istanbul</code></pre><p>In npm scripts:</p><pre><code class="language-json">&quot;coverage&quot;: &quot;./node_modules/istanbul/lib/cli cover _mocha test/index.js&quot;</code></pre><p>or, if you are using ES6 in your tests, do <code>npm i -D babel-cli</code> and run it using babel-node:</p><pre><code class="language-json">&quot;coverage&quot;: &quot;babel-node ./node_modules/istanbul/lib/cli cover _mocha test/index.js&quot;</code></pre><p>Note that <code>_mocha</code>, with underscore, is the actual runner. <code>mocha</code> seems to be just a wrapper around it.</p><p>Run this script with <code>npm run coverage</code> and it will generate a <code>coverage</code> folder with illegible coverage data, and print some results to the console. You should put this folder in .gitignore, with <code>echo coverage &gt;&gt; .gitignore</code>.</p><h2>Code coverage insight service</h2><p>Just sign up to <a href="https://coveralls.io/">Coveralls</a> and add the Github repo you want to watch.</p><h2>Coverage reporting tool</h2><p>Install node-coveralls with:</p><pre><code class="language-sh">npm i -D node-coveralls</code></pre><p>This will install a tool that knows how to get you <code>coverage</code> folder and report it to the Coveralls service.</p><p>But you are not going to make those reports manually. Instead, your CI server will do this. Since I&#x27;m assuming you are using TravisCI, you should already have a <code>.travis.yml</code> file. Add:</p><pre><code class="language-yml">after_success:
  - npm run coverage
  - npm run report-coverage</code></pre><p><code>coverage</code> is the script that creates the coverage report. <code>report-coverage</code> is the script that takes that data and reports it to the service. Since this is running in your CI server, set it up to run for every pull request/push.</p><p>The script for <code>npm run report-coverage</code> is:</p><pre><code class="language-json">&quot;report-coverage&quot;: &quot;cat ./coverage/lcov.info | coveralls&quot;</code></pre><p>The combination of Coveralls + TravisCI makes that you don&#x27;t have to provide any kind of token for the two services communicate. If you choose different services, you might need an extra step of configuring some access token.</p><p>Extra: if you choose to use Codecov, you should use instead:</p><pre><code class="language-sh">npm i -D codecov.io</code></pre><p>and</p><pre><code class="language-json">&quot;report-coverage&quot;: &quot;cat ./coverage/lcov.info | codecov&quot;</code></pre><h2>Extra: checking coverage as part of your CI</h2><p>Want to make your build fail if your coverage falls bellow some threshold? Add an extra script to your <code>.travis.yml</code> to be run in your CI build:</p><pre><code class="language-yml">script:
  # ...
  - npm run check-coverage</code></pre><p>and define that script in <code>package.json</code>:</p><pre><code class="language-json">&quot;check-coverage&quot;: &quot;istanbul check-coverage --statements 70 --branches 70 --functions 70 --lines 70&quot;,</code></pre><p>Those <code>70</code>s are the percentage of coverage that you want as a threshold. Your build will fail if those thresholds are not met.</p></article><div id="disqus_thread"></div><script type="text/javascript">
var disqus_config = function () {
  this.page.url = 'https://rafaeleyng.github.io/javascript-code-coverage-with-instanbul-and-coveralls';
  this.page.identifier = '/javascript-code-coverage-with-instanbul-and-coveralls';
};

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://rafaeleyng.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></section></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"document":{"content":"\n## Code coverage\n\nIf you want to set up code coverage measurements in a project, there are usually 4 things that you'll need:\n\n- a **test runner** (like [Mocha](https://github.com/mochajs/mocha), [AVA](https://github.com/sindresorhus/ava)), to run your tests\n- a **code coverage** tool (like [Istanbul](https://github.com/gotwarlost/istanbul), [nyc](https://github.com/bcoe/nyc)), to generate code coverage reports\n- a **code coverage insight** service (like [Coveralls](https://coveralls.io/), [Codecov](https://codecov.io/)), to provide you a nice visualization of your code coverage data\n- a **reporting** tool (like [node-coveralls](https://github.com/nickmerwin/node-coveralls), [codecov.io](https://github.com/cainus/codecov.io/)), to send your reports to some service\n\n## Assumptions\n\nI'll assume you already have Mocha locally installed (`npm i -D mocha`) as your test runner, and show you how to do the rest.\n\nI'll also assume that you have TravisCI server configured for your project.\n\n### npm scripts\n\nnpm scripts are scripts you add inside package.json. You can add arbitrary shell script commands there, like: `\"scripts\": { \"print-something\": \"echo 'something'\" }`. You can run this script by invoking it by its name: `npm run print-something`.\n\nI try to use npm scripts as much as possible, to avoid global dependencies and to avoid the clutter to manually invoke local dependencies. So all examples here will use this approach.\n\n\n## Code coverage tool\n\nThe principle is: instead of directly running your tests, you set up a middle man to do this and generate the coverage reports. Enter Istanbul.\n\n```sh\nnpm i -D istanbul\n```\n\nIn npm scripts:\n\n```json\n\"coverage\": \"./node_modules/istanbul/lib/cli cover _mocha test/index.js\"\n```\n\nor, if you are using ES6 in your tests, do `npm i -D babel-cli` and run it using babel-node:\n\n```json\n\"coverage\": \"babel-node ./node_modules/istanbul/lib/cli cover _mocha test/index.js\"\n```\n\nNote that `_mocha`, with underscore, is the actual runner. `mocha` seems to be just a wrapper around it.\n\nRun this script with `npm run coverage` and it will generate a `coverage` folder with illegible coverage data, and print some results to the console. You should put this folder in .gitignore, with `echo coverage \u003e\u003e .gitignore`.\n\n\n## Code coverage insight service\n\nJust sign up to [Coveralls](https://coveralls.io/) and add the Github repo you want to watch.\n\n\n## Coverage reporting tool\n\nInstall node-coveralls with:\n\n```sh\nnpm i -D node-coveralls\n```\n\nThis will install a tool that knows how to get you `coverage` folder and report it to the Coveralls service.\n\nBut you are not going to make those reports manually. Instead, your CI server will do this. Since I'm assuming you are using TravisCI, you should already have a `.travis.yml` file. Add:\n\n```yml\nafter_success:\n  - npm run coverage\n  - npm run report-coverage\n```\n\n`coverage` is the script that creates the coverage report. `report-coverage` is the script that takes that data and reports it to the service. Since this is running in your CI server, set it up to run for every pull request/push.\n\nThe script for `npm run report-coverage` is:\n\n```json\n\"report-coverage\": \"cat ./coverage/lcov.info | coveralls\"\n```\n\nThe combination of Coveralls + TravisCI makes that you don't have to provide any kind of token for the two services communicate. If you choose different services, you might need an extra step of configuring some access token.\n\nExtra: if you choose to use Codecov, you should use instead:\n\n```sh\nnpm i -D codecov.io\n```\n\nand\n\n```json\n\"report-coverage\": \"cat ./coverage/lcov.info | codecov\"\n```\n\n## Extra: checking coverage as part of your CI\n\nWant to make your build fail if your coverage falls bellow some threshold? Add an extra script to your `.travis.yml` to be run in your CI build:\n\n```yml\nscript:\n  # ...\n  - npm run check-coverage\n```\n\nand define that script in `package.json`:\n\n```json\n\"check-coverage\": \"istanbul check-coverage --statements 70 --branches 70 --functions 70 --lines 70\",\n```\n\nThose `70`s are the percentage of coverage that you want as a threshold. Your build will fail if those thresholds are not met.\n","data":{"title":"JavaScript Code Coverage With Instanbul and Coveralls","date":"2016-01-14T23:50:18.000Z","keywords":"test, coverage, javascript, npm","excerpt":"A fast lane to set up code coverage in your project\n"}},"slug":"javascript-code-coverage-with-instanbul-and-coveralls"}}},"page":"/post","query":{"slug":"javascript-code-coverage-with-instanbul-and-coveralls"},"buildId":"AhDaCruZbHr7pP-l8v6XC","nextExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/runtime/polyfills-2998c20c30097f9c8a42.js"></script><script async="" data-next-page="/post" src="/_next/static/AhDaCruZbHr7pP-l8v6XC/pages/post.js"></script><script async="" data-next-page="/_app" src="/_next/static/AhDaCruZbHr7pP-l8v6XC/pages/_app.js"></script><script src="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" async=""></script><script src="/_next/static/chunks/framework.03885e3762b811c06d48.js" async=""></script><script src="/_next/static/chunks/commons.2d46a4062a63030a7155.js" async=""></script><script src="/_next/static/runtime/main-fd16d9fd7045bb52879a.js" async=""></script><script src="/_next/static/chunks/a1bc03cf.0a53ccc93557b67d94bb.js" async=""></script><script src="/_next/static/chunks/60cb64cc4f732b57203c53cc08057239476ea6be.b5baf6500ce0ba950094.js" async=""></script><script src="/_next/static/chunks/60cb64cc4f732b57203c53cc08057239476ea6be_CSS.37da1e6c94fa5227f4d3.js" async=""></script><script src="/_next/static/AhDaCruZbHr7pP-l8v6XC/_buildManifest.js" async=""></script><script src="/_next/static/AhDaCruZbHr7pP-l8v6XC/_ssgManifest.js" async=""></script></body></html>