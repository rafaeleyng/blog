<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="preload" href="https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&amp;display=optional" as="style"/><title>Simple Git Hooks With Ghooks</title><meta name="description" content="Rafael Eyng&#x27;s tech blog"/><meta name="language" content="en"/><meta name="content-language" content="en"/><meta name="author" content="Rafael Eyng"/><meta name="keywords" content="software, development, javascript, github, node, docker, blog"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="canonical" href="https://rafaeleyng.github.io/simple-git-hooks-with-ghooks"/><link rel="shortcut icon" href="/favicon.png" type="image/x-icon"/><link href="https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&amp;display=optional" rel="stylesheet" type="text/css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-154633858-1"></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-154633858-1');
</script><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/e83c54905e1409242ee1a2330441cd232091e570_CSS.7b3f6175.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e83c54905e1409242ee1a2330441cd232091e570_CSS.7b3f6175.chunk.css"/><link rel="preload" href="/_next/static/E5zKtSWyHCoyngCKK54Qr/pages/post.js" as="script"/><link rel="preload" href="/_next/static/E5zKtSWyHCoyngCKK54Qr/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.03885e3762b811c06d48.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.2d46a4062a63030a7155.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-fd16d9fd7045bb52879a.js" as="script"/><link rel="preload" href="/_next/static/chunks/a1bc03cf.5784ec4ab76361fe4054.js" as="script"/><link rel="preload" href="/_next/static/chunks/e83c54905e1409242ee1a2330441cd232091e570.751c034d2cba01f871b4.js" as="script"/><link rel="preload" href="/_next/static/chunks/e83c54905e1409242ee1a2330441cd232091e570_CSS.c4a6afef92e8dd991da1.js" as="script"/></head><body><div id="__next"><div class="container"><header class="site-header single-column"><a class="blog-title" href="/">Rafael Eyng&#x27;s Blog</a><nav class="blog-menu"><a target="_blank" rel="noopener" href="https://rafaeleyng.github.io/me">About</a><a target="_blank" rel="noopener" href="https://github.com/rafaeleyng/rafaeleyng.github.io">Github</a></nav></header></div><header class="page-header"><div class="container single-column"><h1>Simple Git Hooks With Ghooks</h1><p class="post-meta"><time itemProp="datePublished" dateTime="2016-01-09">Jan 9, 2016</time></p></div></header><main class="container single-column"><section class="post"><span class="hidden" itemProp="publisher">Rafael Eyng</span><span class="hidden" itemProp="keywords">git, hooks, workflow</span><article class="post-content" itemProp="articleBody"><h2>git hooks</h2><p>git provides a way to <em>hook</em> some git actions (like commit, push) to run custom scripts. These hooks run at different moments of the actions, and you can use them to improve your workflow in several ways. Some examples are preventing a commit to happen if a test fails, or running some kind of build tool before pushing.</p><p>When you create a git project, you&#x27;ll have a bunch of hook samples inside <code>.git/hooks</code>. None of these are actually run because they have the <code>.sample</code> extension. Remove that extension and the hook starts to get called.</p><h2>What&#x27;s wrong with git hooks</h2><p>Your git hooks stay inside the <code>.git</code> folder. Since this folder contains your local project versioning history, it is not versioned. The problem is that even if you create a hook file, you can&#x27;t commit this file and push it to your remote, so this file won&#x27;t exist for the rest of your team.</p><h2>ghooks to the rescue!</h2><p>Start by installing ghooks:</p><pre><code class="language-sh">npm i -D ghooks</code></pre><p>When you do that, ghooks will create a whole lot of files inside your <code>.git/hooks</code> dir. But that is not a problem anymore, because everybody that clones your project will also have those files created when they run <code>npm install</code>. And all those hook files are identical: they simply require ghooks and call it passing the hook file&#x27;s own name. So supposing we are to run a commit, git calls the hook, but the hook calls ghooks, saying &quot;hey, git are running the pre-commit hook, handle it at your will&quot;.</p><p>ghooks will then look for how you want to handle that hook. The way to go is define this is in your <code>package.json</code>:</p><pre><code class="language-js">&quot;config&quot;: {
  &quot;ghooks&quot;: {
    &quot;pre-commit&quot;: &quot;npm run test&quot;
  }
}</code></pre><p>Even though your git hooks (auto generated by ghooks) are still buried inside <code>.git</code> folder, the actual code they will execute is not. Now you can keep this code versioned and consistent across your team.</p><h3>A little bit of shell scripting</h3><p>Programs are called, run, and exit. The program exits with a code number that tells whether it ran successfully or not. <code>0</code> is success. Any other code is an error.</p><p>Some git hooks have the power to actually prevent the git action to be performed. <em>pre-commit</em> is one of them. If your hook exits non-zero, the commit won&#x27;t happen. This way, you can run your linter or tests before commiting, and if they fail, the task runner will exit non-zero and the commit won&#x27;t happen.</p><h3>A gotcha with exit codes</h3><p>You can actually run more than one command in your hook. For instance, you could run <code>npm run test; npm run build</code>.</p><p>You have to be aware that, for git, it only matters the exit code of the last program of your hook. So even if <code>npm run test</code> fails, <code>npm run build</code> could succeed and the commit will happen.</p><p>I ran into this myself. I was in a situation where I had to commit a bundled JavaScript file in my project. Before commiting, I wanted my hook to run my linter, my tests and to bundle the file with production configuration. But the bundled file would need to be added to my git index, so I needed to run <code>git add dist/bundle.js</code>. I created a <code>pre-commit</code> npm script that would call my appropriate Gulp tasks and ended up with a pre-commit ghook like <code>npm run pre-commit; git add dist/bundle.js</code>.</p><p>You see the problem? Even if my linter or tests failed, or even if my bundler (Webpack) failed to bundle my file, <code>git add dist/bundle.js</code> would succeed and exit with <code>0</code>. My commit <strong>would</strong> happen, and it <strong>shouldn&#x27;t</strong>.</p><p>The solution was to use a shell script <code>if</code> (if you don&#x27;t know how a shell script <code>if</code> works, I warn you that is not like you expect from other programming languages):</p><pre><code class="language-javascript">  &quot;pre-commit&quot;: &quot;if npm run pre-commit; then git add dist/bundle.js; else printf &#x27;pre-commit error: fix the test and/or lint errors and commit again&#x27;; (exit 1); fi&quot;</code></pre><p>See the <code>(exit 1)</code> there? That will make my hook exit non-zero and make my commit not happen.</p><h3>Skipping hooks</h3><p>Let&#x27;s say you added a line to your README. You don&#x27;t need to run lint/tests/build. Just use:</p><pre><code class="language-sh">git commit -m &#x27;message&#x27; --no-verify</code></pre><h2>List of git hooks</h2><p>Check the <a href="https://git-scm.com/docs/githooks">docs</a>.</p></article><div id="disqus_thread"></div><script type="text/javascript">
var disqus_config = function () {
  this.page.url = 'https://rafaeleyng.github.io/simple-git-hooks-with-ghooks';
  this.page.identifier = '/simple-git-hooks-with-ghooks';
};

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://rafaeleyng.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></section></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"document":{"content":"\n## git hooks\n\ngit provides a way to *hook* some git actions (like commit, push) to run custom scripts. These hooks run at different moments of the actions, and you can use them to improve your workflow in several ways. Some examples are preventing a commit to happen if a test fails, or running some kind of build tool before pushing.\n\nWhen you create a git project, you'll have a bunch of hook samples inside `.git/hooks`. None of these are actually run because they have the `.sample` extension. Remove that extension and the hook starts to get called.\n\n## What's wrong with git hooks\n\nYour git hooks stay inside the `.git` folder. Since this folder contains your local project versioning history, it is not versioned. The problem is that even if you create a hook file, you can't commit this file and push it to your remote, so this file won't exist for the rest of your team.\n\n## ghooks to the rescue!\n\nStart by installing ghooks:\n\n```sh\nnpm i -D ghooks\n```\n\nWhen you do that, ghooks will create a whole lot of files inside your `.git/hooks` dir. But that is not a problem anymore, because everybody that clones your project will also have those files created when they run `npm install`. And all those hook files are identical: they simply require ghooks and call it passing the hook file's own name. So supposing we are to run a commit, git calls the hook, but the hook calls ghooks, saying \"hey, git are running the pre-commit hook, handle it at your will\".\n\nghooks will then look for how you want to handle that hook. The way to go is define this is in your `package.json`:\n\n```js\n\"config\": {\n  \"ghooks\": {\n    \"pre-commit\": \"npm run test\"\n  }\n}\n```\n\nEven though your git hooks (auto generated by ghooks) are still buried inside `.git` folder, the actual code they will execute is not. Now you can keep this code versioned and consistent across your team.\n\n### A little bit of shell scripting\n\nPrograms are called, run, and exit. The program exits with a code number that tells whether it ran successfully or not. `0` is success. Any other code is an error.\n\nSome git hooks have the power to actually prevent the git action to be performed. *pre-commit* is one of them. If your hook exits non-zero, the commit won't happen. This way, you can run your linter or tests before commiting, and if they fail, the task runner will exit non-zero and the commit won't happen.\n\n### A gotcha with exit codes\n\nYou can actually run more than one command in your hook. For instance, you could run `npm run test; npm run build`.\n\nYou have to be aware that, for git, it only matters the exit code of the last program of your hook. So even if `npm run test` fails, `npm run build` could succeed and the commit will happen.\n\nI ran into this myself. I was in a situation where I had to commit a bundled JavaScript file in my project. Before commiting, I wanted my hook to run my linter, my tests and to bundle the file with production configuration. But the bundled file would need to be added to my git index, so I needed to run `git add dist/bundle.js`. I created a `pre-commit` npm script that would call my appropriate Gulp tasks and ended up with a pre-commit ghook like `npm run pre-commit; git add dist/bundle.js`.\n\nYou see the problem? Even if my linter or tests failed, or even if my bundler (Webpack) failed to bundle my file, `git add dist/bundle.js` would succeed and exit with `0`. My commit **would** happen, and it **shouldn't**.\n\nThe solution was to use a shell script `if` (if you don't know how a shell script `if` works, I warn you that is not like you expect from other programming languages):\n\n```javascript\n  \"pre-commit\": \"if npm run pre-commit; then git add dist/bundle.js; else printf 'pre-commit error: fix the test and/or lint errors and commit again'; (exit 1); fi\"\n```\n\nSee the `(exit 1)` there? That will make my hook exit non-zero and make my commit not happen.\n\n### Skipping hooks\n\nLet's say you added a line to your README. You don't need to run lint/tests/build. Just use:\n\n```sh\ngit commit -m 'message' --no-verify\n```\n\n## List of git hooks\n\nCheck the [docs](https://git-scm.com/docs/githooks).\n","data":{"title":"Simple Git Hooks With Ghooks","date":"2016-01-10T00:18:59.000Z","keywords":"git, hooks, workflow","excerpt":"Learn how to use git hooks easily to leverage best practices in your workflow.\n"}},"slug":"simple-git-hooks-with-ghooks"}}},"page":"/post","query":{"slug":"simple-git-hooks-with-ghooks"},"buildId":"E5zKtSWyHCoyngCKK54Qr","nextExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/runtime/polyfills-2998c20c30097f9c8a42.js"></script><script async="" data-next-page="/post" src="/_next/static/E5zKtSWyHCoyngCKK54Qr/pages/post.js"></script><script async="" data-next-page="/_app" src="/_next/static/E5zKtSWyHCoyngCKK54Qr/pages/_app.js"></script><script src="/_next/static/runtime/webpack-9369c5c69dbf6d4912cb.js" async=""></script><script src="/_next/static/chunks/framework.03885e3762b811c06d48.js" async=""></script><script src="/_next/static/chunks/commons.2d46a4062a63030a7155.js" async=""></script><script src="/_next/static/runtime/main-fd16d9fd7045bb52879a.js" async=""></script><script src="/_next/static/chunks/a1bc03cf.5784ec4ab76361fe4054.js" async=""></script><script src="/_next/static/chunks/e83c54905e1409242ee1a2330441cd232091e570.751c034d2cba01f871b4.js" async=""></script><script src="/_next/static/chunks/e83c54905e1409242ee1a2330441cd232091e570_CSS.c4a6afef92e8dd991da1.js" async=""></script><script src="/_next/static/E5zKtSWyHCoyngCKK54Qr/_buildManifest.js" async=""></script><script src="/_next/static/E5zKtSWyHCoyngCKK54Qr/_ssgManifest.js" async=""></script></body></html>